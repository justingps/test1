<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS Dashboard</title>
    <link rel="icon" href="https://justingps.github.io/dpr/logo.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e3a8a;
            --accent-color: #db2777;
            --light-color: #e0e7ff;
            --dark-color: #111827;
            --success-color: #059669;
            --warning-color: #d97706;
            --info-color: #2563eb;
            --background-color: #e5e7eb;
            --card-bg: #e5e7eb;
            --text-color: #1f2a44;
            --text-light: #6b7280;
            --border-color: #d1d5db;
            --shadow-light: #ffffff;
            --shadow-dark: #b0b7c3;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.5;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: var(--background-color);
        }

        .login-form {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-logo {
            height: 80px;
            margin-bottom: 1.5rem;
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--dark-color);
        }

        .login-input {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .login-button {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .login-button:hover {
            background-color: var(--secondary-color);
        }

        .company-footer {
            margin-top: 2rem;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Logout Button */
        .logout-button {
            background: linear-gradient(145deg, var(--accent-color), #be185d);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 2px 2px 4px var(--shadow-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logout-button:hover {
            background: linear-gradient(145deg, #be185d, var(--accent-color));
            box-shadow: 2px 2px 6px var(--shadow-dark);
        }

        .container {
            max-width: 1440px;
            margin: 1.5rem auto;
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 6px 12px 12px var(--shadow-dark),
                        -6px -6px 12px var(--shadow-light);
            display: none; /* Initially hidden until login */
        }

        .header {
            background: linear-gradient(145deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo {
            height: 60px;
            border-radius: 8px;
        }

        .company-info {
            font-family: 'Roboto', sans-serif;
            font-size: 0.9rem;
            line-height: 1.6;
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }

        .company-info strong {
            font-weight: 500;
        }

        .tabs {
            display: flex;
            background-color: var(--card-bg);
            padding: 0.5rem;
        }

        .tab {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            font-family: 'Roboto', sans-serif;
            font-weight: 500;
            color: var(--text-light);
            transition: all 0.2s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.25rem;
            border-radius: 8px;
            background: var(--card-bg);
            box-shadow: 4px 4px 8px var(--shadow-dark),
                        -4px -4px 8px var(--shadow-light);
        }

        .tab:hover {
            background: linear-gradient(145deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: inset 2px 2px 4px rgba(0, 0, 0, 0.0);
        }

        .tab.active {
            background: var(--card-bg);
            color: var(--primary-color);
            font-weight: bold 500;
            box-shadow: inset 4px 4px 8px var(--shadow-dark),
                        inset -4px -4px 8px var(--shadow-light);
        }

        .tab-content {
            display: none;
            padding: 1.5rem;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        h1, h2, h3 {
            color: var(--dark-color);
            margin-top: 0;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-align: center;
            position: relative;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: -0.3rem;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 2px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
        }

        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin: 1rem 0;
            padding: 1rem;
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: inset 4px 4px 8px var(--shadow-dark),
                        inset -4px -4px 8px var(--shadow-light);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            min-width: 180px;
            position: relative;
        }

        .filter-label {
            font-weight: 500;
            color: var(--dark-color);
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .date-picker, .area-select, .discipline-select, .wi-input {
            padding: 0.6rem;
            font-size: 0.85rem;
            border: none;
            border-radius: 8px;
            background-color: var(--card-bg);
            font-family: 'Inter', sans-serif;
            flex: 1;
            box-shadow: inset 2px 2px 4px var(--shadow-dark),
                        inset -2px -2px 4px var(--shadow-light);
            transition: all 0.2s ease;
        }

        .date-picker:focus, .area-select:focus, .discipline-select:focus, .wi-input:focus {
            outline: none;
            box-shadow: inset 1px 1px 2px var(--shadow-dark),
                        inset -1px -1px 2px var(--shadow-light),
                        0 0 0 2px var(--primary-color);
        }

        .no-data {
            color: var(--text-light);
            font-style: italic;
            margin: 1.5rem 0;
            text-align: center;
            padding: 1.5rem;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: inset 4px 4px 8px var(--shadow-dark),
                        inset -4px -4px 8px var(--shadow-light);
        }

        .work-group {
            margin-bottom: 1.5rem;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: 6px 6px 12px var(--shadow-dark),
                        -6px -6px 12px var(--shadow-light);
        }

        .work-group-header {
            background: linear-gradient(145deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 0.8rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .work-group-title {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .work-group-id {
            background-color: var(--card-bg);
            color: var(--primary-color);
            padding: 0.3rem 0.8rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.8rem;
            box-shadow: inset 2px 2px 4px var(--shadow-dark),
                        inset -2px -2px 4px var(--shadow-light);
        }

        .work-description {
            white-space: pre-line;
            background-color: var(--card-bg);
            padding: 1rem;
            margin: 0;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .resource-table, .progress-table, .status-table {
            width: 100%;
            border-collapse: collapse;
        }

        .resource-table th, .progress-table th, .status-table th {
            background-color: var(--light-color);
            color: var(--dark-color);
            padding: 0.7rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .resource-table td, .progress-table td, .status-table td {
            padding: 0.7rem;
            font-size: 0.8rem;
        }

        .resource-table tr:last-child td, .progress-table tr:last-child td, .status-table tr:last-child td {
            border-bottom: none;
        }

        .resource-table tr:hover, .progress-table tr:hover, .status-table tr:hover {
            background-color: rgba(37, 99, 235, 0.1);
        }

        .summary-card {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 0.8rem;
            margin: 1rem;
        }

        .summary-item {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 0.8rem;
            box-shadow: 4px 4px 8px var(--shadow-dark),
                        -4px -4px 8px var(--shadow-light);
        }

        .summary-label {
            font-size: 0.7rem;
            color: var(--text-light);
            margin-bottom: 0.3rem;
            text-transform: uppercase;
            font-weight: 500;
        }

        .summary-value {
            font-weight: 700;
            color: var(--dark-color);
            font-size: 1.1rem;
        }

        .chart-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .chart-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 6px 6px 12px var(--shadow-dark),
                        -6px -6px 12px var(--shadow-light);
        }

        .chart-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: var(--dark-color);
            text-align: center;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: 3fr 2fr;
            gap: 1rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.8rem;
        }

        .data-table th, .data-table td {
            padding: 0.7rem;
            text-align: left;
            font-size: 0.8rem;
        }

        .data-table th {
            background-color: var(--light-color);
            font-weight: 600;
            color: var(--dark-color);
        }

        .data-table tr:hover {
            background-color: rgba(37, 99, 235, 0.1);
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.4rem;
        }

        .status-active {
            background-color: var(--success-color);
        }

        .status-inactive {
            background-color: var(--warning-color);
        }

        .daily-summary {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 6px 6px 12px var(--shadow-dark),
                        -6px -6px 12px var(--shadow-light);
        }

        .daily-summary h3 {
            margin: 0 0 0.8rem;
            font-size: 1rem;
            color: var(--dark-color);
        }

        .daily-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 0.8rem;
        }

        .daily-summary-item {
            background-color: var(--card-bg);
            padding: 0.8rem;
            border-radius: 8px;
            box-shadow: 4px 4px 8px var(--shadow-dark),
                        -4px -4px 8px var(--shadow-light);
        }

        .daily-summary-area {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
            font-size: 0.9rem;
        }

        .daily-summary-stats {
            display: flex;
            justify-content: space-between;
            gap: 0.4rem;
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: inset 4px 4px 8px var(--shadow-dark),
                        inset -4px -4px 8px var(--shadow-light);
        }

        .loading-spinner {
            width: 32px;
            height: 32px;
            border: 3px solid rgba(37, 99, 235, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 0.8s ease-in-out infinite;
            margin-bottom: 0.8rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 0.4rem;
        }

        .loading-subtext {
            color: var(--text-light);
            font-size: 0.8rem;
            margin-top: 0.3rem;
            font-style: italic;
        }

        .summary-date-filter {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: inset 4px 4px 8px var(--shadow-dark),
                        inset -4px -4px 8px var(--shadow-light);
        }

        .summary-date-label {
            font-weight: 500;
            color: var(--dark-color);
            font-size: 0.85rem;
        }

        .details-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem;
            box-shadow: 4px 4px 8px var(--shadow-dark),
                        -4px -4px 8px var(--shadow-light);
        }

        .details-card h3 {
            margin: 0 0 0.8rem;
            font-size: 1rem;
            color: var(--dark-color);
        }

        @media (max-width: 1200px) {
            .summary-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .daily-summary-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
                padding: 1rem;
            }

            .filter-container {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
                margin-bottom: 0.8rem;
            }

            .filter-label {
                margin-bottom: 0.3rem;
            }

            .date-picker, .area-select, .discipline-select, .wi-input {
                width: 100%;
            }

            .tabs {
                overflow-x: auto;
                white-space: nowrap;
            }

            .tab {
                padding: 0.6rem 1rem;
            }

            .daily-summary-grid {
                grid-template-columns: 1fr;
            }

            .summary-card {
                grid-template-columns: 1fr 1fr;
            }

            .summary-date-filter {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        @media (max-width: 576px) {
            .summary-card {
                grid-template-columns: 1fr;
            }

            .chart-card {
                padding: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-form">
            <img src="https://justingps.github.io/dpr/logo.png" alt="Company Logo" class="login-logo">
            <input type="text" id="username" class="login-input" placeholder="Username" required>
            <input type="password" id="password" class="login-input" placeholder="Password" required>
            <button class="login-button" onclick="login()">Login</button>
            <div class="company-footer">Gulf Petrochemical Services LLC.</div>
        </div>
    </div>

    <!-- Dashboard Container (hidden initially) -->
    <div class="container" id="dashboardContainer">
        <div class="header">
            <div class="logo-container">
                <img src="https://justingps.github.io/dpr/logo.png" alt="Company Logo" class="logo">
                <div class="company-info">
                    <div><strong>CONTRACTOR:</strong> GULF PETROCHEMICAL SERVICES LLC.</div>
                    <div><strong>CLIENT:</strong> OCCIDENTAL OF OMAN INC.</div>
                    <div><strong>CONTRACT:</strong> GFSC - MASTER INTEGRATED SERVICES AGREEMENT No. 24000110790</div>
                    <div><strong>TODAY:</strong> <span id="currentDate"></span></div>
                </div>
            </div>
            <button class="logout-button" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="openTab('summary')"><i class="fas fa-chart-bar"></i> Summary</div>
            <div class="tab" onclick="openTab('reports')"><i class="fas fa-file-alt"></i> Reports</div>
            <div class="tab" onclick="openTab('status')"><i class="fas fa-table"></i> Status</div>
            <div class="tab" onclick="openTab('resource')"><i class="fas fa-users"></i> Resource</div>
        </div>

        <div id="summary" class="tab-content active">
            <h1>Work Analytics Dashboard</h1>
            
            <div class="summary-date-filter">
                <span class="summary-date-label"><i class="far fa-calendar-alt"></i> Date Range:</span>
                <input type="date" id="summaryStartDate" class="date-picker" onchange="updateSummaryCharts()">
                <span>to</span>
                <input type="date" id="summaryEndDate" class="date-picker" onchange="updateSummaryCharts()">
            </div>
            
            <div id="summaryLoading" class="loading-container">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading Summary Data</div>
                <div class="loading-subtext">Analyzing work patterns and crew distributions</div>
            </div>
            
            <div id="summaryContent" style="display: none;">
                <div class="summary-grid">
                    <div>
                        <div class="chart-card">
                            <div class="chart-title">Daily Crew Allocation by Area</div>
                            <canvas id="crewAllocationChart"></canvas>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-title">Crew Size Trend by Area</div>
                            <canvas id="crewTrendChart"></canvas>
                        </div>

                        <div class="chart-card">
                            <div class="chart-title">Top 5 Work Groups by Crew Utilization</div>
                            <canvas id="workGroupUtilizationChart"></canvas>
                        </div>
                    </div>
                    
                    <div>
                        <div class="chart-card">
                            <div class="chart-title">Recent Activity</div>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Foremen</th>
                                        <th>Crew Size</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentActivity">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="reports" class="tab-content">
            <div class="filter-container">
                <div class="filter-group">
                    <span class="filter-label"><i class="far fa-calendar-alt"></i> Date:</span>
                    <input type="date" id="reportDate" class="date-picker" onchange="applyFilters()">
                </div>
                <div class="filter-group">
                    <span class="filter-label"><i class="fas fa-map-marker-alt"></i> Area/Block:</span>
                    <select id="areaSelect" class="area-select" onchange="applyFilters()">
                        <option value="all">All Areas</option>
                        <option value="Safha (Block-9)">Safha (Block-9)</option>
                        <option value="Block-62">Block-62</option>
                        <option value="Other">Other</option>
                        <option value="Wadi Latham (Block-9)">Wadi Latham (Block-9)</option>
                        <option value="Infrastructure Project">Infrastructure Project</option>
                        <option value="Khamila (Bock-27)">Khamila (Bock-27)</option>
                        <option value="FRT Project">FRT Project</option>
                        <option value="Power Project">Power Project</option>
                    </select>
                </div>
                <div class="filter-group">
                    <span class="filter-label"><i class="fas fa-cogs"></i> Discipline:</span>
                    <select id="disciplineSelect" class="discipline-select" onchange="applyFilters()">
                        <option value="all">All Disciplines</option>
                        <option value="Piping & Mechanical">Piping & Mechanical</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Civil">Civil</option>
                        <option value="Instrumentation">Instrumentation</option>
                    </select>
                </div>
                <div class="filter-group">
                    <span class="filter-label"><i class="fas fa-search"></i> WI:</span>
                    <input type="text" id="wiInput" class="wi-input" placeholder="Search WI..." oninput="applyFilters()">
                </div>
            </div>
            
            <div id="reportsLoading" class="loading-container">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading Report Data</div>
                <div class="loading-subtext">Please wait while we fetch your reports</div>
            </div>
            
            <div id="reportsContent" style="display: none;">
                <div id="dailySummaryContainer" class="daily-summary">
                    <!-- Daily summary will be displayed here -->
                </div>
                
                <div id="reportContainer">
                    <!-- Data will be displayed here -->
                </div>
            </div>
        </div>

        <div id="status" class="tab-content">
            <h1>Active Projects Status</h1>
            
            <div class="filter-container">
                <div class="filter-group">
                    <span class="filter-label"><i class="far fa-calendar-alt"></i> Select Date:</span>
                    <input type="date" id="statusDate" class="date-picker" onchange="updateStatusTable()">
                </div>
                <div class="filter-group">
                    <span class="filter-label"><i class="fas fa-map-marker-alt"></i> Area/Block:</span>
                    <select id="statusAreaSelect" class="area-select" onchange="updateStatusTable()">
                        <option value="all">All Areas</option>
                        <option value="Safha (Block-9)">Safha (Block-9)</option>
                        <option value="Block-62">Block-62</option>
                        <option value="Other">Other</option>
                        <option value="Wadi Latham (Block-9)">Wadi Latham (Block-9)</option>
                        <option value="Infrastructure Project">Infrastructure Project</option>
                        <option value="Khamila (Bock-27)">Khamila (Bock-27)</option>
                        <option value="FRT Project">FRT Project</option>
                        <option value="Power Project">Power Project</option>
                    </select>
                </div>
            </div>
            
            <div id="statusLoading" class="loading-container">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading Status Data</div>
                <div class="loading-subtext">Fetching active projects information</div>
            </div>
            
            <div id="statusContent" style="display: none;">
                <div class="details-card">
                    <h3 id="statusTableTitle">Active Projects on [Selected Date]</h3>
                    <div class="summary-card">
                        <div class="summary-item">
                            <div class="summary-label">Total Projects</div>
                            <div id="totalProjects" class="summary-value">0</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Total Crew Size</div>
                            <div id="totalCrewSize" class="summary-value">0</div>
                        </div>
                    </div>
                    <table class="status-table">
                        <thead>
                            <tr>
                                <th>SL. NO.</th>
                                <th>ID</th>
                                <th>CREW LEAD</th>
                                <th>PROJECTS</th>
                                <th>AREA</th>
                                <th>CREW SIZE</th>
                                <th>DISCIPLINE</th>
                            </tr>
                        </thead>
                        <tbody id="statusTableBody">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="resource" class="tab-content">
            <h1>Resource Allocation</h1>
            
            <div class="filter-container">
                <div class="filter-group">
                    <span class="filter-label"><i class="far fa-calendar-alt"></i> Select Date:</span>
                    <input type="date" id="resourceDate" class="date-picker" onchange="updateResourceTables()">
                </div>
                <div class="filter-group">
                    <span class="filter-label"><i class="fas fa-map-marker-alt"></i> Area/Block:</span>
                    <select id="resourceAreaSelect" class="area-select" onchange="updateResourceTables()">
                        <option value="all">All Areas</option>
                        <option value="Safha (Block-9)">Safha (Block-9)</option>
                        <option value="Block-62">Block-62</option>
                        <option value="Other">Other</option>
                        <option value="Wadi Latham (Block-9)">Wadi Latham (Block-9)</option>
                        <option value="Infrastructure Project">Infrastructure Project</option>
                        <option value="Khamila (Bock-27)">Khamila (Bock-27)</option>
                        <option value="FRT Project">FRT Project</option>
                        <option value="Power Project">Power Project</option>
                    </select>
                </div>
            </div>
            
            <div id="resourceLoading" class="loading-container">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading Resource Data</div>
                <div class="loading-subtext">Fetching resource allocation details</div>
            </div>
            
            <div id="resourceContent" style="display: none;">
                <div class="details-card">
                    <h3 id="resourceTableTitle">Resources on [Selected Date]</h3>
                    <div class="summary-card">
                        <div class="summary-item">
                            <div class="summary-label">Total Manpower</div>
                            <div id="totalManpower" class="summary-value">0</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Total Equipment</div>
                            <div id="totalEquipment" class="summary-value">0</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Not Found</div>
                            <div id="totalNotFound" class="summary-value">0</div>
                        </div>
                    </div>
                    
                    <div class="details-card">
                        <h3>Manpower Resources</h3>
                        <table class="resource-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Resource ID</th>
                                    <th>Designation</th>
                                    <th>Project (WI NO)</th>
                                    <th>Area</th>
                                    <th>Foreman</th>
                                </tr>
                            </thead>
                            <tbody id="manpowerTableBody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="details-card">
                        <h3>Equipment Resources</h3>
                        <table class="resource-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Resource ID</th>
                                    <th>Designation</th>
                                    <th>Project (WI NO)</th>
                                    <th>Area</th>
                                    <th>Foreman</th>
                                </tr>
                            </thead>
                            <tbody id="equipmentTableBody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="details-card">
                        <h3>Not Found Resources</h3>
                        <table class="resource-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Resource ID</th>
                                    <th>Designation</th>
                                    <th>Project (WI NO)</th>
                                    <th>Area</th>
                                    <th>Foreman</th>
                                </tr>
                            </thead>
                            <tbody id="notFoundTableBody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRMvKP4HfM5zZpM3RjdpPcX0DZA3yWpGhXt_lqpzblpbIQW7vcJswPPm8gMdmVZ366FCUwZGLCsF1fb/pub?gid=0&single=true&output=csv';
        
        let allData = [];
        let charts = {};
        
        // Preload data when page loads (even before login)
        window.onload = function() {
            preloadData();
            
            // Set up event listener for login form submission
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        };
        
        function preloadData() {
            fetch(SHEET_URL)
                .then(response => response.text())
                .then(csvData => {
                    allData = parseCSV(csvData);
                    console.log('Data preloaded successfully');
                })
                .catch(error => {
                    console.error('Error preloading data:', error);
                });
        }
        
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'admin' && password === 'admin') {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('dashboardContainer').style.display = 'block';
                
                // Initialize dashboard after successful login
                initializeDashboard();
            } else {
                alert('Invalid credentials. Please try again.');
            }
        }
        
        function logout() {
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            
            // Clear form fields
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }
        
        function initializeDashboard() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            const oneWeekAgo = new Date(yesterday);
            oneWeekAgo.setDate(yesterday.getDate() - 6); // One week range ending yesterday
            
            document.getElementById('reportDate').valueAsDate = yesterday;
            document.getElementById('statusDate').valueAsDate = yesterday;
            document.getElementById('resourceDate').valueAsDate = yesterday;
            document.getElementById('summaryStartDate').valueAsDate = oneWeekAgo;
            document.getElementById('summaryEndDate').valueAsDate = yesterday;
            document.getElementById('currentDate').textContent = formatDateForDisplay(today);
            
            // If data is already preloaded, show it immediately
            if (allData.length > 0) {
                document.getElementById('summaryLoading').style.display = 'none';
                document.getElementById('summaryContent').style.display = 'block';
                document.getElementById('reportsLoading').style.display = 'none';
                document.getElementById('reportsContent').style.display = 'block';
                document.getElementById('statusLoading').style.display = 'none';
                document.getElementById('statusContent').style.display = 'block';
                document.getElementById('resourceLoading').style.display = 'none';
                document.getElementById('resourceContent').style.display = 'block';
                
                applyFilters();
                if (document.getElementById('status').classList.contains('active')) {
                    updateStatusTable();
                }
                if (document.getElementById('summary').classList.contains('active')) {
                    updateSummaryCharts();
                }
                if (document.getElementById('resource').classList.contains('active')) {
                    updateResourceTables();
                }
            } else {
                // If data isn't preloaded yet, load it now
                loadData();
            }
        }
        
        function openTab(tabName) {
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
            
            if (tabName === 'summary' && allData.length > 0) {
                updateSummaryCharts();
            } else if (tabName === 'status' && allData.length > 0) {
                updateStatusTable();
            } else if (tabName === 'resource' && allData.length > 0) {
                updateResourceTables();
            }
        }
        
        function formatDateForDisplay(date) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const day = date.getDate();
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            return `${day}-${month}-${year}`;
        }
        
        function loadData() {
            document.getElementById('summaryLoading').style.display = 'flex';
            document.getElementById('reportsLoading').style.display = 'flex';
            document.getElementById('statusLoading').style.display = 'flex';
            document.getElementById('resourceLoading').style.display = 'flex';
            
            fetch(SHEET_URL)
                .then(response => response.text())
                .then(csvData => {
                    allData = parseCSV(csvData);
                    
                    document.getElementById('summaryLoading').style.display = 'none';
                    document.getElementById('summaryContent').style.display = 'block';
                    document.getElementById('reportsLoading').style.display = 'none';
                    document.getElementById('reportsContent').style.display = 'block';
                    document.getElementById('statusLoading').style.display = 'none';
                    document.getElementById('statusContent').style.display = 'block';
                    document.getElementById('resourceLoading').style.display = 'none';
                    document.getElementById('resourceContent').style.display = 'block';
                    
                    applyFilters();
                    if (document.getElementById('status').classList.contains('active')) {
                        updateStatusTable();
                    }
                    if (document.getElementById('summary').classList.contains('active')) {
                        updateSummaryCharts();
                    }
                    if (document.getElementById('resource').classList.contains('active')) {
                        updateResourceTables();
                    }
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    document.getElementById('reportContainer').innerHTML = 
                        '<p class="no-data">Error loading data. Please try again later.</p>';
                    document.getElementById('statusTableBody').innerHTML = 
                        '<tr><td colspan="7" class="no-data">Error loading data. Please try again later.</td></tr>';
                    document.getElementById('manpowerTableBody').innerHTML = 
                        '<tr><td colspan="6" class="no-data">Error loading data. Please try again later.</td></tr>';
                    document.getElementById('equipmentTableBody').innerHTML = 
                        '<tr><td colspan="6" class="no-data">Error loading data. Please try again later.</td></tr>';
                    document.getElementById('notFoundTableBody').innerHTML = 
                        '<tr><td colspan="6" class="no-data">Error loading data. Please try again later.</td></tr>';
                    
                    document.getElementById('summaryLoading').style.display = 'none';
                    document.getElementById('reportsLoading').style.display = 'none';
                    document.getElementById('statusLoading').style.display = 'none';
                    document.getElementById('resourceLoading').style.display = 'none';
                    document.getElementById('summaryContent').style.display = 'block';
                    document.getElementById('reportsContent').style.display = 'block';
                    document.getElementById('statusContent').style.display = 'block';
                    document.getElementById('resourceContent').style.display = 'block';
                });
        }
        
        function parseCSV(csv) {
            const lines = [];
            let currentLine = [];
            let inQuotes = false;
            let currentField = '';
            
            for (let i = 0; i < csv.length; i++) {
                const char = csv[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    currentLine.push(currentField.trim());
                    currentField = '';
                } else if (char === '\n' && !inQuotes) {
                    currentLine.push(currentField.trim());
                    lines.push(currentLine);
                    currentLine = [];
                    currentField = '';
                } else {
                    currentField += char;
                }
            }
            
            if (currentField.trim() !== '' || currentLine.length > 0) {
                currentLine.push(currentField.trim());
                lines.push(currentLine);
            }
            
            if (lines.length === 0) return [];
            
            const headers = lines[0];
            const result = [];
            
            for (let i = 1; i < lines.length; i++) {
                const obj = {};
                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j]] = lines[i][j] || '';
                }
                result.push(obj);
            }
            
            return result;
        }
        
        function parseSheetDate(dateString) {
            if (!dateString) return null;
            
            const months = {
                'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5,
                'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11
            };
            
            const mmmFormat = dateString.match(/^(\d{1,2})-([A-Za-z]{3})-(\d{4})$/);
            if (mmmFormat) {
                const day = parseInt(mmmFormat[1], 10);
                const month = months[mmmFormat[2]];
                const year = parseInt(mmmFormat[3], 10);
                return new Date(year, month, day);
            }
            
            const yyyyFormat = dateString.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);
            if (yyyyFormat) {
                const year = parseInt(yyyyFormat[1], 10);
                const month = parseInt(yyyyFormat[2], 10) - 1;
                const day = parseInt(yyyyFormat[3], 10);
                return new Date(year, month, day);
            }
            
            const ddmmFormat = dateString.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
            if (ddmmFormat) {
                const day = parseInt(ddmmFormat[1], 10);
                const month = parseInt(ddmmFormat[2], 10) - 1;
                const year = parseInt(ddmmFormat[3], 10);
                return new Date(year, month, day);
            }
            
            return null;
        }
        
        function formatDateForComparison(date) {
            if (!date) return '';
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        function groupDataByProject(data, dateKey, areaFilter = 'all', disciplineFilter = 'all', wiFilter = '') {
            const grouped = {};
            const uniqueCrewIds = new Set();
            
            data.forEach(row => {
                const rowDate = parseSheetDate(row.DATE);
                if (!rowDate) return;
                
                const formattedRowDate = formatDateForComparison(rowDate);
                if (formattedRowDate !== dateKey) return;
                
                if (areaFilter !== 'all' && row['AREA / BLOCK'] !== areaFilter) return;
                if (disciplineFilter !== 'all' && row['DISCIPLINE'] !== disciplineFilter) return;
                if (wiFilter && row['WI NO'] && !row['WI NO'].toLowerCase().includes(wiFilter.toLowerCase())) return;
                
                const key = `${row['FOREMAN ID']}|${row['WI NO']}|${row['AREA / BLOCK']}|${row['DISCIPLINE']}`;
                if (!grouped[key]) {
                    grouped[key] = {
                        id: row['FOREMAN ID'] || '-',
                        crewLead: row['FOREMAN NAME'] || '-',
                        projects: row['WI NO'] || '-',
                        area: row['AREA / BLOCK'] || 'Unknown',
                        discipline: row['DISCIPLINE'] || '-',
                        permits: new Set(),
                        resources: new Set(),
                        foremen: new Set(),
                        details: {
                            'DESCRIPTION OF WORK': row['DESCRIPTION OF WORK'] || '',
                            'PERMIT NUMBER': row['PERMIT NUMBER'] || '',
                            'VALIDATION TIME': row['VALIDATION TIME'] || '',
                            'SUSPENSION TIME': row['SUSPENSION TIME'] || '',
                            'PROGRESS': row['PROGRESS'] || ''
                        },
                        resourceDetails: []
                    };
                }
                
                if (row['PERMIT NUMBER']) {
                    grouped[key].permits.add(row['PERMIT NUMBER']);
                }
                
                if (row['RESOURCE ID']) {
                    grouped[key].resources.add(row['RESOURCE ID']);
                    uniqueCrewIds.add(row['RESOURCE ID']);
                    grouped[key].resourceDetails.push({
                        'RESOURCE ID': row['RESOURCE ID'],
                        'RESOURCE DESIGNATION': row['RESOURCE DESIGNATION'] || '-',
                        'MANPOWER / EQUIPMENT': row['MANPOWER / EQUIPMENT'] || '',
                        'TIME-IN': row['TIME-IN'] || '-',
                        'TIME-OUT': row['TIME-OUT'] || '-'
                    });
                }
                
                if (row['FOREMAN ID']) {
                    grouped[key].foremen.add(row['FOREMAN ID']);
                }
            });
            
            return { grouped, totalCrewSize: uniqueCrewIds.size };
        }
        
        function applyFilters() {
            const selectedDate = document.getElementById('reportDate').valueAsDate;
            const selectedArea = document.getElementById('areaSelect').value;
            const selectedDiscipline = document.getElementById('disciplineSelect').value;
            const wiSearch = document.getElementById('wiInput').value.trim();
            
            if (!selectedDate) return;
            
            const formattedSelectedDate = formatDateForComparison(selectedDate);
            
            const filteredData = allData.filter(row => {
                if (!row.DATE) return false;
                
                const rowDate = parseSheetDate(row.DATE);
                if (!rowDate) return false;
                const formattedRowDate = formatDateForComparison(rowDate);
                if (formattedRowDate !== formattedSelectedDate) return false;
                
                if (selectedArea !== 'all' && row['AREA / BLOCK'] !== selectedArea) return false;
                if (selectedDiscipline !== 'all' && row['DISCIPLINE'] !== selectedDiscipline) return false;
                if (wiSearch && row['WI NO'] && !row['WI NO'].toLowerCase().includes(wiSearch.toLowerCase())) return false;
                
                return true;
            });
            
            displayData(filteredData, formattedSelectedDate, selectedArea, selectedDiscipline, wiSearch);
        }
        
        function displayData(data, dateKey, selectedArea, selectedDiscipline, wiSearch) {
            const container = document.getElementById('reportContainer');
            const summaryContainer = document.getElementById('dailySummaryContainer');
            
            if (data.length === 0) {
                container.innerHTML = '<p class="no-data">No records found for the selected filters.</p>';
                summaryContainer.innerHTML = '';
                return;
            }
            
            const { grouped, totalCrewSize } = groupDataByProject(data, dateKey, selectedArea, selectedDiscipline, wiSearch);
            
            const areaSummary = {};
            Object.values(grouped).forEach(group => {
                const area = group.area;
                if (!areaSummary[area]) {
                    areaSummary[area] = {
                        permits: new Set(),
                        crewSize: new Set(),
                        foremen: new Set()
                    };
                }
                
                group.permits.forEach(permit => areaSummary[area].permits.add(permit));
                group.resources.forEach(crew => areaSummary[area].crewSize.add(crew));
                group.foremen.forEach(foreman => areaSummary[area].foremen.add(foreman));
            });
            
            const selectedDate = document.getElementById('reportDate').valueAsDate;
            const formattedDate = formatDateForDisplay(selectedDate);
            
            let summaryHtml = `
                <h3>Daily Summary for ${formattedDate}</h3>
                <div class="daily-summary-grid">
            `;
            
            Object.entries(areaSummary).forEach(([area, stats]) => {
                summaryHtml += `
                    <div class="daily-summary-item">
                        <div class="daily-summary-area">${area}</div>
                        <div class="daily-summary-stats">
                            <div>
                                <div class="summary-label">Permits</div>
                                <div class="summary-value">${stats.permits.size}</div>
                            </div>
                            <div>
                                <div class="summary-label">Crew Size</div>
                                <div class="summary-value">${stats.crewSize.size}</div>
                            </div>
                            <div>
                                <div class="summary-label">Foremen</div>
                                <div class="summary-value">${stats.foremen.size}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            const totalPermits = Object.values(areaSummary).reduce((sum, area) => sum + area.permits.size, 0);
            const totalForemen = Object.values(areaSummary).reduce((sum, area) => sum + area.foremen.size, 0);
            
            summaryHtml += `
                    <div class="daily-summary-item" style="background-color: #dbeafe;">
                        <div class="daily-summary-area">TOTAL</div>
                        <div class="daily-summary-stats">
                            <div>
                                <div class="summary-label">Permits</div>
                                <div class="summary-value">${totalPermits}</div>
                            </div>
                            <div>
                                <div class="summary-label">Crew Size</div>
                                <div class="summary-value">${totalCrewSize}</div>
                            </div>
                            <div>
                                <div class="summary-label">Foremen</div>
                                <div class="summary-value">${totalForemen}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            summaryContainer.innerHTML = summaryHtml;
            
            let html = '';
            let groupCounter = 1;
            
            Object.values(grouped).forEach(group => {
                const manpowerCount = group.resourceDetails.filter(r => 
                    r['MANPOWER / EQUIPMENT'].toLowerCase() === 'manpower'
                ).length;
                
                const equipmentCount = group.resourceDetails.filter(r => 
                    r['MANPOWER / EQUIPMENT'].toLowerCase() === 'equipment'
                ).length;
                
                const progressLines = group.details['PROGRESS'].replace(/"/g, '').split('\n').map(line => {
                    const [description, unit] = line.split(' = ');
                    return { description, unit };
                });
                
                html += `
                    <div class="work-group">
                        <div class="work-group-header">
                            <span class="work-group-title">Work Progress Report - Group #${groupCounter}</span>
                            <span class="work-group-id">WI NO: ${group.projects}</span>
                        </div>
                        
                        <div class="work-description">${group.details['DESCRIPTION OF WORK'].replace(/"/g, '')}</div>
                        
                        <div class="summary-card">
                            <div class="summary-item">
                                <div class="summary-label">Foreman ID</div>
                                <div class="summary-value">${group.id}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Foreman Name</div>
                                <div class="summary-value">${group.crewLead}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Area/Block</div>
                                <div class="summary-value">${group.area}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Permit Number</div>
                                <div class="summary-value">${group.details['PERMIT NUMBER']}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Work Hours</div>
                                <div class="summary-value">${group.details['VALIDATION TIME']} to ${group.details['SUSPENSION TIME']}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Manpower</div>
                                <div class="summary-value">${manpowerCount}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Equipment</div>
                                <div class="summary-value">${equipmentCount}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Crew Size</div>
                                <div class="summary-value">${group.resources.size}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Discipline</div>
                                <div class="summary-value">${group.discipline}</div>
                            </div>
                        </div>
                        
                        <div class="details-card">
                            <h3>Progress Details</h3>
                            <table class="progress-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Description</th>
                                        <th>Quantity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${progressLines.map((line, index) => `
                                        <tr>
                                            <td>${index + 1}</td>
                                            <td>${line.description || '-'}</td>
                                            <td>${line.unit || '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="details-card">
                            <h3>Resource Details</h3>
                            <table class="resource-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Resource ID</th>
                                        <th>Designation</th>
                                        <th>Type</th>
                                        <th>Time-In</th>
                                        <th>Time-Out</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${group.resourceDetails.map((resource, index) => `
                                        <tr>
                                            <td>${index + 1}</td>
                                            <td>${resource['RESOURCE ID']}</td>
                                            <td>${resource['RESOURCE DESIGNATION']}</td>
                                            <td>${resource['MANPOWER / EQUIPMENT']}</td>
                                            <td>${resource['TIME-IN']}</td>
                                            <td>${resource['TIME-OUT']}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                groupCounter++;
            });
            
            container.innerHTML = html;
        }
        
        function updateSummaryCharts() {
            if (allData.length === 0) return;
            
            const startDate = document.getElementById('summaryStartDate').valueAsDate;
            const endDate = document.getElementById('summaryEndDate').valueAsDate;
            
            if (!startDate || !endDate) return;
            
            const datesInRange = getDatesInRange(startDate, endDate);
            const areaCrewData = {};
            const areaTrendData = {};
            const workGroupData = {};
            const recentActivityData = {};
            
            datesInRange.forEach(date => {
                const dateKey = formatDateForComparison(date);
                areaTrendData[dateKey] = {};
                recentActivityData[dateKey] = {
                    date: dateKey,
                    foremen: new Set(),
                    crewSize: new Set(),
                    active: false
                };
                
                const { grouped } = groupDataByProject(allData, dateKey);
                
                Object.values(grouped).forEach(group => {
                    const area = group.area;
                    if (!areaCrewData[area]) {
                        areaCrewData[area] = {
                            totalCrew: 0,
                            dates: {},
                            foremen: new Set()
                        };
                    }
                    if (!areaCrewData[area].dates[dateKey]) {
                        areaCrewData[area].dates[dateKey] = {
                            crewSize: new Set(),
                            foremen: new Set()
                        };
                    }
                    
                    group.resources.forEach(crew => {
                        areaCrewData[area].dates[dateKey].crewSize.add(crew);
                        recentActivityData[dateKey].crewSize.add(crew);
                    });
                    group.foremen.forEach(foreman => {
                        areaCrewData[area].dates[dateKey].foremen.add(foreman);
                        areaCrewData[area].foremen.add(foreman);
                        recentActivityData[dateKey].foremen.add(foreman);
                    });
                    
                    if (!areaTrendData[dateKey][area]) {
                        areaTrendData[dateKey][area] = 0;
                    }
                    areaTrendData[dateKey][area] += group.resources.size;
                    
                    const workGroupKey = `${group.projects} - ${area}`;
                    if (!workGroupData[workGroupKey]) {
                        workGroupData[workGroupKey] = {
                            crewSize: new Set(),
                            area: area,
                            wiNo: group.projects
                        };
                    }
                    group.resources.forEach(crew => workGroupData[workGroupKey].crewSize.add(crew));
                    
                    recentActivityData[dateKey].active = true;
                });
            });
            
            const crewAllocationLabels = datesInRange.map(date => formatDateForDisplay(date));
            const crewAllocationDatasets = [];
            
            const areasByCrewSize = Object.keys(areaCrewData)
                .map(area => ({
                    name: area,
                    total: Object.keys(areaCrewData[area].dates)
                        .reduce((sum, date) => sum + areaCrewData[area].dates[date].crewSize.size, 0)
                }))
                .sort((a, b) => b.total - a.total)
                .slice(0, 5);
            
            const colors = [
                'rgba(37, 99, 235, 0.8)',
                'rgba(139, 92, 246, 0.8)',
                'rgba(5, 150, 105, 0.8)',
                'rgba(217, 119, 6, 0.8)',
                'rgba(219, 39, 119, 0.8)'
            ];
            
            areasByCrewSize.forEach((area, index) => {
                const areaData = datesInRange.map(date => {
                    const dateKey = formatDateForComparison(date);
                    return areaCrewData[area.name].dates[dateKey] ? 
                        areaCrewData[area.name].dates[dateKey].crewSize.size : 0;
                });
                
                crewAllocationDatasets.push({
                    label: area.name,
                    data: areaData,
                    backgroundColor: colors[index],
                    borderColor: colors[index],
                    borderWidth: 1
                });
            });
            
            const trendLabels = datesInRange.map(date => formatDateForDisplay(date));
            const trendDatasets = [];
            
            areasByCrewSize.forEach((area, index) => {
                const trendData = datesInRange.map(date => {
                    const dateKey = formatDateForComparison(date);
                    return areaTrendData[dateKey][area.name] || 0;
                });
                
                trendDatasets.push({
                    label: area.name,
                    data: trendData,
                    borderColor: colors[index],
                    backgroundColor: colors[index],
                    borderWidth: 2,
                    tension: 0.3,
                    fill: false
                });
            });
            
            const workGroupLabels = [];
            const workGroupDatasets = [];
            const topWorkGroups = Object.keys(workGroupData)
                .map(group => ({
                    name: group,
                    total: workGroupData[group].crewSize.size
                }))
                .sort((a, b) => b.total - a.total)
                .slice(0, 5);
            
            const workGroupDataValues = topWorkGroups.map(group => group.total);
            workGroupLabels.push(...topWorkGroups.map(group => group.name));
            
            workGroupDatasets.push({
                label: 'Crew Utilization',
                data: workGroupDataValues,
                backgroundColor: colors,
                borderColor: colors,
                borderWidth: 1
            });
            
            const recentActivityHtml = Object.values(recentActivityData)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .map(day => `
                    <tr>
                        <td>${formatDateForDisplay(new Date(day.date))}</td>
                        <td>${day.foremen.size}</td>
                        <td>${day.crewSize.size}</td>
                        <td><span class="status-indicator ${day.active ? 'status-active' : 'status-inactive'}"></span>
                            ${day.active ? 'Active' : 'No Activity'}</td>
                    </tr>
                `).join('');
            document.getElementById('recentActivity').innerHTML = recentActivityHtml;
            
            if (charts.crewAllocationChart) charts.crewAllocationChart.destroy();
            if (charts.crewTrendChart) charts.crewTrendChart.destroy();
            if (charts.workGroupUtilizationChart) charts.workGroupUtilizationChart.destroy();
            
            const ctx1 = document.getElementById('crewAllocationChart').getContext('2d');
            charts.crewAllocationChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: crewAllocationLabels,
                    datasets: crewAllocationDatasets
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Crew Size'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
            
            const ctx2 = document.getElementById('crewTrendChart').getContext('2d');
            charts.crewTrendChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: trendLabels,
                    datasets: trendDatasets
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Crew Size'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
            
            const ctx3 = document.getElementById('workGroupUtilizationChart').getContext('2d');
            charts.workGroupUtilizationChart = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: workGroupLabels,
                    datasets: workGroupDatasets
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Work Group'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Total Crew Utilization'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
        }

        function updateStatusTable() {
            const selectedDate = document.getElementById('statusDate').valueAsDate;
            const selectedArea = document.getElementById('statusAreaSelect').value;
            if (!selectedDate) return;

            const formattedSelectedDate = formatDateForComparison(selectedDate);
            const formattedDisplayDate = formatDateForDisplay(selectedDate);

            document.getElementById('statusTableTitle').textContent = `Active Projects on ${formattedDisplayDate}`;

            const { grouped, totalCrewSize } = groupDataByProject(allData, formattedSelectedDate, selectedArea);

            if (Object.keys(grouped).length === 0) {
                document.getElementById('totalProjects').textContent = '0';
                document.getElementById('totalCrewSize').textContent = '0';
                document.getElementById('statusTableBody').innerHTML = 
                    '<tr><td colspan="7" class="no-data">No records found for the selected date and area.</td></tr>';
                return;
            }

            const statusData = Object.values(grouped).map((group, index) => ({
                slNo: index + 1,
                id: group.id,
                crewLead: group.crewLead,
                projects: group.projects,
                area: group.area,
                crewSize: group.resources.size,
                discipline: group.discipline
            }));

            document.getElementById('totalProjects').textContent = statusData.length;
            document.getElementById('totalCrewSize').textContent = totalCrewSize;

            const statusHtml = statusData.map(item => `
                <tr>
                    <td>${item.slNo}</td>
                    <td>${item.id}</td>
                    <td>${item.crewLead}</td>
                    <td>${item.projects}</td>
                    <td>${item.area}</td>
                    <td>${item.crewSize}</td>
                    <td>${item.discipline}</td>
                </tr>
            `).join('');

            document.getElementById('statusTableBody').innerHTML = statusHtml;
        }
        
        function updateResourceTables() {
            const selectedDate = document.getElementById('resourceDate').valueAsDate;
            const selectedArea = document.getElementById('resourceAreaSelect').value;
            if (!selectedDate) return;

            const formattedSelectedDate = formatDateForComparison(selectedDate);
            const formattedDisplayDate = formatDateForDisplay(selectedDate);

            document.getElementById('resourceTableTitle').textContent = `Resources on ${formattedDisplayDate}`;

            const { grouped } = groupDataByProject(allData, formattedSelectedDate, selectedArea);

            if (Object.keys(grouped).length === 0) {
                document.getElementById('totalManpower').textContent = '0';
                document.getElementById('totalEquipment').textContent = '0';
                document.getElementById('totalNotFound').textContent = '0';
                document.getElementById('manpowerTableBody').innerHTML = 
                    '<tr><td colspan="6" class="no-data">No manpower records found.</td></tr>';
                document.getElementById('equipmentTableBody').innerHTML = 
                    '<tr><td colspan="6" class="no-data">No equipment records found.</td></tr>';
                document.getElementById('notFoundTableBody').innerHTML = 
                    '<tr><td colspan="6" class="no-data">No not found records found.</td></tr>';
                return;
            }

            let manpowerResources = [];
            let equipmentResources = [];
            let notFoundResources = [];
            let manpowerCount = 0;
            let equipmentCount = 0;
            let notFoundCount = 0;

            Object.values(grouped).forEach(group => {
                group.resourceDetails.forEach(resource => {
                    const resourceEntry = {
                        resourceId: resource['RESOURCE ID'],
                        designation: resource['RESOURCE DESIGNATION'],
                        project: group.projects,
                        area: group.area,
                        foreman: group.crewLead
                    };

                    const type = resource['MANPOWER / EQUIPMENT'].toLowerCase();
                    if (type === 'manpower') {
                        manpowerResources.push(resourceEntry);
                        manpowerCount++;
                    } else if (type === 'equipment') {
                        equipmentResources.push(resourceEntry);
                        equipmentCount++;
                    } else {
                        notFoundResources.push(resourceEntry);
                        notFoundCount++;
                    }
                });
            });

            document.getElementById('totalManpower').textContent = manpowerCount;
            document.getElementById('totalEquipment').textContent = equipmentCount;
            document.getElementById('totalNotFound').textContent = notFoundCount;

            const manpowerHtml = manpowerResources.map((resource, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${resource.resourceId}</td>
                    <td>${resource.designation}</td>
                    <td>${resource.project}</td>
                    <td>${resource.area}</td>
                    <td>${resource.foreman}</td>
                </tr>
            `).join('');

            const equipmentHtml = equipmentResources.map((resource, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${resource.resourceId}</td>
                    <td>${resource.designation}</td>
                    <td>${resource.project}</td>
                    <td>${resource.area}</td>
                    <td>${resource.foreman}</td>
                </tr>
            `).join('');

            const notFoundHtml = notFoundResources.map((resource, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${resource.resourceId}</td>
                    <td>${resource.designation}</td>
                    <td>${resource.project}</td>
                    <td>${resource.area}</td>
                    <td>${resource.foreman}</td>
                </tr>
            `).join('');

            document.getElementById('manpowerTableBody').innerHTML = manpowerHtml || 
                '<tr><td colspan="6" class="no-data">No manpower records found.</td></tr>';
            document.getElementById('equipmentTableBody').innerHTML = equipmentHtml || 
                '<tr><td colspan="6" class="no-data">No equipment records found.</td></tr>';
            document.getElementById('notFoundTableBody').innerHTML = notFoundHtml || 
                '<tr><td colspan="6" class="no-data">No not found records found.</td></tr>';
        }
        
        function getDatesInRange(startDate, endDate) {
            const dates = [];
            let currentDate = new Date(startDate);
            
            while (currentDate <= endDate) {
                dates.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return dates;
        }
        
        function getLastNDays(n) {
            const dates = [];
            for (let i = n - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(formatDateForComparison(date));
            }
            return dates;
        }
        
        function parseTime(timeString) {
            if (!timeString) return null;
            
            const match = timeString.match(/^(\d{1,2}):(\d{2})$/);
            if (!match) return null;
            
            const hours = parseInt(match[1], 10);
            const minutes = parseInt(match[2], 10);
            
            const date = new Date();
            date.setHours(hours, minutes, 0, 0);
            return date;
        }
    </script>
</body>
</html>
